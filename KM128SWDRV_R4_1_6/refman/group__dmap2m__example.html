<!-- HTML header for doxygen 1.8.9-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>MKMxxZxxACxx5 Bare Metal Software Drivers: DMA Peripheral to Memory Transfer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://www.mathjax.org/mathjax/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="drivers.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="nxp_logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">MKMxxZxxACxx5 Bare Metal Software Drivers
   &#160;<span id="projectnumber">R4.1.6</span>
   </div>
   <div id="projectbrief">Reference Manual</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Introduction</span></a></li>
      <li><a href="pages.html"><span>Pages</span></a></li>
      <li><a href="modules.html"><span>Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__dmap2m__example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">DMA Peripheral to Memory Transfer<div class="ingroups"><a class="el" href="group__dma__drv.html">DMA Driver</a> &raquo; <a class="el" href="group__dma__examples.html">DMA Examples</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p>This example shows advanced use of the Direct Memory Access (DMA) module for storing results of the analogue to digital conversion to the buffer without software intervention. The example configures AFE channel in low power mode, clocked by 1MHz IRC and with PGA disabled. The OSR value=1024 thus output sample rate=976Hz. After AFE channel and DMA transfer converted 24-bit results to the dedicated RAM memory array are configured the conversion starts and device enters Very Low Power Stop (VLPS) mode. When the last converted 24-bit result is transferred (after ~ 4 seconds) the DMA channel generates interrupt request and device resumes VLPR operation. </p><dl class="section user"><dt>Source code:</dt><dd><div class="fragment"><div class="line"><span class="comment">/******************************************************************************</span></div>
<div class="line"><span class="comment"> * (c) Copyright 2010-2015, Freescale Semiconductor Inc.</span></div>
<div class="line"><span class="comment"> * ALL RIGHTS RESERVED.</span></div>
<div class="line"><span class="comment"> ******************************************************************************</span></div>
<div class="line"><span class="comment"> * dmap2m_test.c</span></div>
<div class="line"><span class="comment"> ******************************************************************************/</span></div>
<div class="line"><span class="preprocessor">#include &quot;drivers.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* static data definitions                                                    */</span></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="group__basic__data__types.html#ga56f1a81c92849566ae864511088eb7e8" title="32-bit signed integer ">int32</a> <span class="keyword">volatile</span> samples[3000];</div>
<div class="line"></div>
<div class="line"><span class="comment">/* DMA callback prototype                                                     */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> dma0_callback (<a class="code" href="group__dma__ch__callback.html#gad8e9ca770720ddc2ab12b573bf77c7b7">DMA_CH_CALLBACK_TYPE</a> type);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> main (<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">/* Initialize SMC and SIM modules                                           */</span></div>
<div class="line">  <a class="code" href="group__sim__macro.html#ga29bf1a8a2c379d066cbf00ce6f4b650b" title="SIM initialization. ">SIM_Init</a> (SIM_MODULE_LP_CONFIG);</div>
<div class="line">  <a class="code" href="group__smc__macro.html#ga7ff642749cfc3a0c0eefef4e9d6ca47f" title="SMC initialization. ">SMC_Init</a> (<a class="code" href="group__smc__config.html#gae2d757fe0a137d096da5d44a280caf23" title="Only Very-Low-Power (VLPS) mode enabled. ">SMC_MODULE_VLPS_ON_VLLS_OFF_CONFIG</a>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Clock mode 2:1:1, 2.00 MHz (chip is trimmed)                             */</span></div>
<div class="line">  <a class="code" href="group__sim__macro.html#ga567e1e6f1a395f6c5b9cc81b6448b77c" title="Sets system clock mode. ">SIM_SetClkMode</a> (<a class="code" href="group__sim__sysmode.html#ga7c9bc048168e85b3f19b8c6debbf9085" title="SYSCLK:BUSCLK:FLASHCLK = 2:1:1. ">SYSCLK_MODE1</a>);</div>
<div class="line">  <a class="code" href="group__sim__macro.html#gae802e44bf4be3211746b72f563ec9c07" title="Sets system clock divider mode. ">SIM_SetClkDiv</a>  (<a class="code" href="group__sim__sysdiv.html#gac23fb41a687d80a69ce51a99b2a394c7" title="divide by 01 ">SYSCLK_DIV1</a>);</div>
<div class="line">  <a class="code" href="group__fll__macro.html#ga298ab412924c0bbeb4c4423bea476085" title="FLL initialization. ">FLL_Init</a> (<a class="code" href="group__fll__config.html#gac052a889de9fe56362f2f289b55b7d33" title="FLL Bypassed Low Power Internal (2MHz). Clocked by Fast Internal Reference Clock. ...">FLL_MODULE_BLPI_2MHZ_CONFIG</a>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* VREF module must be initialized after SIM module                         */</span></div>
<div class="line">  <a class="code" href="group__vref__macro.html#ga3b9c6be2a4e53c90f3185139709c9169" title="Voltage reference initialization. ">VREF_Init</a> (<a class="code" href="group__vref__module__config.html#ga546e266645fe33d6ca1a7a109ed9b331" title="Voltage reference setting. ">VREF_MODULE_CHOP_EN_ICOMP_EN_REG_EN_VREFL_EN_LPWR_CONFIG</a>,</div>
<div class="line">             <a class="code" href="group__vref__switch__config.html#ga76a2087bd1bf466c987b6625eb5f895f" title="Voltage reference switch setting. ">VREF_SWITCH_S1_L_S2_L_S3_L_BUFF_DI</a>);</div>
<div class="line">  <a class="code" href="group__vref__macro.html#ga996a9e70c90befba7b221a931e3dd99a" title="Lower reference voltage Trim value change. ">VREFL_Trim</a>( 3);                                 <span class="comment">/* VREFL trimmed to 0.400 V */</span></div>
<div class="line"></div>
<div class="line">  <a class="code" href="group__pmc__macro.html#ga4989c8a839b3afbb64eedb27b3bf9232" title="Enables bandgap reference in VLPx and VLLSx modes. ">PMC_SetBGEN</a> ();                                 <span class="comment">/* enable VREF in VLPR mode */</span></div>
<div class="line">  <a class="code" href="group__smc__macro.html#gabbc72e0b58d6236338fe1e11eebefce0" title="Sets device operating mode. ">SMC_SetMode</a> (VLPR);                             <span class="comment">/* transition to VLPR mode  */</span></div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Install DMA0 callback and initialize DMA0 channel                        */</span></div>
<div class="line">  <a class="code" href="group__dma__macro.html#ga0ba7b8bdfe9a859e36bd85bbc92f7995" title="Installs callback function for specified DMA channel. ">DMA_InstallCallback</a> (DMA0, <a class="code" href="group__cm0plus__prilvl.html#ga5c3ab002d18c704fc8c6b3e341d16d42" title="Priority level 3 (lowest priority) ">PRI_LVL3</a>, dma0_callback);</div>
<div class="line">  <a class="code" href="group__dma__macro.html#ga1d482580824b12e4864d314d8bf84e0f" title="DMA channel initialization. ">DMA_Init</a> (DMA0,<a class="code" href="group__dma__chan__config.html#gaa93f1e3fb098d0c62c1bed4483c0e093" title="Selects hardware initiated cycle steal peripheral to memory data transfer. ">DMA_CH_HWTRG_P2M_CS_CONFIG</a>(<a class="code" href="group__dma0__request__sources.html#ga8ee4d961e09cb9738c8c997e1bce8dac" title="AFE CH0. ">DMA0_REQ_AFE_CH0</a>,<a class="code" href="group__dma__request__sizes.html#gafbf5ab857ff63d69d965f6b2518f0eee" title="4-byte transfer (default) ">DMA_SIZE32BIT</a>,</div>
<div class="line">                                            &amp;AFE_CH0_RR,samples,<span class="keyword">sizeof</span>(samples)));</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Initialize AFE_CH0                                                       */</span></div>
<div class="line">  <a class="code" href="group__afe__macro.html#gaef0d0e4c44baf43d723a8fc02a5d7d98" title="AFE channel initialization. ">AFE_ChInit</a> (<a class="code" href="group__channel__mask.html#gaf6f592bd18a57b35061f111d32a7f637" title="Channel 0. ">CH0</a>,<a class="code" href="group__afe__chan__config.html#ga727289d1b9b5488fa28812d43784046d" title="Selects software trigger continuous conversion mode. PGA is disabled. ">AFE_CH_SWTRG_CCM_PGAOFF_CONFIG</a>(<a class="code" href="group__afe__osr.html#ga4ce063e07cc9f8e48a2643a0f20e2a07" title="f-3dB= 1.75KHz,fn= 3KHz @ fs=6.144MHz ">DEC_OSR1024</a>),0,<a class="code" href="group__cm0plus__prilvl.html#ga3461048206d4aa48866deedbdd269c1b" title="Priority level 0 (highest priority) ">PRI_LVL0</a>,NULL);</div>
<div class="line">  <a class="code" href="group__afe__macro.html#ga0f56303b12f4aa8120a6e19a7cf0c231" title="AFE module initialization. ">AFE_Init</a>   (<a class="code" href="group__afe__module__config.html#ga7cbe1883a90e751f25bf00134ef30d7f" title="Selects low power mode of operation with right justified 2&#39;s complement 32-bit output data format...">AFE_MODULE_LPM_RJFORMAT_CONFIG</a>(<a class="code" href="group__afe__clocks.html#ga6ab3ba12c35b088e78bffd4f1d31f643" title="MCG_IRC_CLK(2MHZ or 32KHz) ">AFE_IRC_CLK</a>, <a class="code" href="group__afe__clkdiv.html#ga37e4a27bacdc52f01a1406dadfa8dce2" title="divide by 4 ">AFE_DIV4</a>, 2000000));</div>
<div class="line">  <a class="code" href="group__afe__macro.html#ga6e67acb7e5da8c2100f8a96509b5fb98" title="Enables DMA conversion on selected AFE channel(s). ">AFE_EnableDMA</a> (<a class="code" href="group__channel__mask.html#gaf6f592bd18a57b35061f111d32a7f637" title="Channel 0. ">CH0</a>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Enable interrupts                                                        */</span></div>
<div class="line">  <a class="code" href="group__cm0plus__macros.html#ga5da0b4bd4b7a8ef8a479008c8ed455c8" title="Enables all interrupts. ">EnableInterrupts</a>();</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Trigger AFE conversions                                                  */</span></div>
<div class="line">  <a class="code" href="group__afe__macro.html#ga0a8e7aabd9e1e19531edaa10bb6af2fd" title="Triggers conversion on selected AFE channel(s). ">AFE_SwTrigger</a> (<a class="code" href="group__channel__mask.html#gaf6f592bd18a57b35061f111d32a7f637" title="Channel 0. ">CH0</a>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Main loop                                                                */</span></div>
<div class="line">  <span class="keywordflow">while</span> (1)</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">/* Transition to VLPS mode                                                */</span></div>
<div class="line">    <a class="code" href="group__smc__macro.html#gabbc72e0b58d6236338fe1e11eebefce0" title="Sets device operating mode. ">SMC_SetMode</a> (VLPS);       <span class="comment">/* Power consumption: 1.01mA@VLPS; 1.04mA@STOP  */</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Wait for 3 seconds to enable current measurement                       */</span></div>
<div class="line">    <a class="code" href="group__cm0plus__macros.html#ga0b5ca6aa7c63e6a510cec72bb3f3f665" title="Delays software execution by number of core clock cycles. ">arch_delay</a>  (3000000);    <span class="comment">/* Power consumption: 1.22mA@VLPR; 2.29mA@RUN   */</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Re-initialize DMA0 for peripheral to memory transfer                   */</span></div>
<div class="line">    <a class="code" href="group__dma__macro.html#ga1d482580824b12e4864d314d8bf84e0f" title="DMA channel initialization. ">DMA_Init</a> (DMA0,<a class="code" href="group__dma__chan__config.html#gaa93f1e3fb098d0c62c1bed4483c0e093" title="Selects hardware initiated cycle steal peripheral to memory data transfer. ">DMA_CH_HWTRG_P2M_CS_CONFIG</a>(<a class="code" href="group__dma0__request__sources.html#ga8ee4d961e09cb9738c8c997e1bce8dac" title="AFE CH0. ">DMA0_REQ_AFE_CH0</a>,<a class="code" href="group__dma__request__sizes.html#gafbf5ab857ff63d69d965f6b2518f0eee" title="4-byte transfer (default) ">DMA_SIZE32BIT</a>,</div>
<div class="line">                                          &amp;AFE_CH0_RR,samples,<span class="keyword">sizeof</span>(samples)));</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* DMA callback function definition                                           */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> dma0_callback (<a class="code" href="group__dma__ch__callback.html#gad8e9ca770720ddc2ab12b573bf77c7b7">DMA_CH_CALLBACK_TYPE</a> type) { <span class="comment">/* wakeup by IRQ */</span>   }</div>
</div><!-- fragment --> </dd></dl>
<dl class="section user"><dt>Toolchain support:</dt><dd><table class="doxtable">
<tr>
<th align="center"><code>IAR EWARM 7.40.7</code></th><th align="center"><code>CodeWarrior 10.6</code></th><th align="center"><code>KEIL uVision 5.15</code></th><th align="center"><code>CrossWorks 3.6</code></th><th align="center"><code>ATOLLIC TrueStudio 5.3.0</code></th><th align="center"><code>Kinetis Design Studio 3.0.0</code>  </th></tr>
<tr>
<td align="center"><b>&diams;</b> </td><td align="center"><b>&diams;</b> </td><td align="center"><b>&diams;</b> </td><td align="center"><b>&diams;</b> </td><td align="center"><b>&diams;</b> </td><td align="center"><b>&diams;</b> </td></tr>
</table>
</dd></dl>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.9-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul class="foot">
    <li class="footer">Tue Nov 22 2016 &copy; 2016 NXP Semiconductors, Inc. All rights reserved.
    </li>
  </ul>
</div>
</body>
</html>
