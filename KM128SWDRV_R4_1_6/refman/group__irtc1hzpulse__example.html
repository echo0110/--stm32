<!-- HTML header for doxygen 1.8.9-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>MKMxxZxxACxx5 Bare Metal Software Drivers: IRTC Fine Compensation Logic</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://www.mathjax.org/mathjax/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="drivers.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="nxp_logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">MKMxxZxxACxx5 Bare Metal Software Drivers
   &#160;<span id="projectnumber">R4.1.6</span>
   </div>
   <div id="projectbrief">Reference Manual</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Introduction</span></a></li>
      <li><a href="pages.html"><span>Pages</span></a></li>
      <li><a href="modules.html"><span>Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__irtc1hzpulse__example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">IRTC Fine Compensation Logic<div class="ingroups"><a class="el" href="group__irtc__drv.html">IRTC Driver</a> &raquo; <a class="el" href="group__irtc__examples.html">IRTC Examples</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p>The fine compensation logic is suitable for many 32.768 kHz crystals, and can correct a wide range of crystal offsets.</p>
<p>The software example initializes IRTC module including so called fine compensation logic, RTCCLKOUT pin to generate 1 Hz pulse output, and <a href="http://www.nxp.com/webapp/sps/site/prod_summary.jsp?code=FREEMASTER" title="FreeMASTER">FreeMASTER</a> interface to communicate through UART2 module (38400/8-N-1). It demonstrates capability of the IRTC module to output a precise 1 Hz pulse output signal (through RTCCLKOUT pin) that represents clock frequency used to drive IRTC's internal time and date counters. This 1 Hz pulse output signal is outputted by the fine compensation logic and is generated with high resolution of the clock edge placement (up to 0.88 ppm) and near 50% duty cycle as shown in Figure 1.</p>
<p>The software sets an integral compensation value, a 2's complement value of the integer part of correction or compensation value that has to be adjusted in every 1 second period, to value -5 (-152.59 ppm), and a fraction compensation value, a fractional part of the correction or compensation value that has to be adjusted in every 1 second period, to value 11 (+2.62 ppm). Note that, integral and fraction compensation values are expressed in terms of number of clock cycles of the 32.768 kHz oscillator clock (30.51 ppm) and fixed 4.194304 MHz clock (0.24 ppm), respectively. </p><dl class="section user"><dt>Parameters of the 1 Hz pulse output generated by the fine compensation block.</dt><dd><div class="image">
<img src="rtcclkout_fine.bmp" alt="rtcclkout_fine.bmp"/>
</div>
  </dd></dl>
<p>You may modify integral and fractional compensation values using <a href="http://www.nxp.com/webapp/sps/site/prod_summary.jsp?code=FREEMASTER" title="FreeMASTER">FreeMASTER</a> interface in order to analyze their impact on frequency of the generated 1 Hz pulse output. </p><dl class="section user"><dt>Source code:</dt><dd><div class="fragment"><div class="line"><span class="comment">/******************************************************************************</span></div>
<div class="line"><span class="comment"> * (c) Copyright 2010-2015, Freescale Semiconductor Inc.</span></div>
<div class="line"><span class="comment"> * ALL RIGHTS RESERVED.</span></div>
<div class="line"><span class="comment"> ******************************************************************************</span></div>
<div class="line"><span class="comment"> * irtc1hzpulse_test.c</span></div>
<div class="line"><span class="comment"> ******************************************************************************/</span></div>
<div class="line"><span class="preprocessor">#include &quot;drivers.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;freemaster.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="group__basic__data__types.html#ga1b956fe1df85f3c132b21edb4e116458" title="8-bit signed integer ">int8</a>  int_comp_val = -5;</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="group__basic__data__types.html#gadde6aaee8457bee49c2a92621fe22b79" title="8-bit unsigned integer ">uint8</a> fra_comp_val = 11;</div>
<div class="line"></div>
<div class="line"><span class="comment">/* FreeMASTER TSA table                                                       */</span></div>
<div class="line">FMSTR_TSA_TABLE_BEGIN(first_table)</div>
<div class="line">    FMSTR_TSA_RW_VAR(int_comp_val, FMSTR_TSA_SINT8)</div>
<div class="line">    FMSTR_TSA_RW_VAR(fra_comp_val, FMSTR_TSA_UINT8)</div>
<div class="line">FMSTR_TSA_TABLE_END()</div>
<div class="line"></div>
<div class="line">FMSTR_TSA_TABLE_LIST_BEGIN()</div>
<div class="line">    FMSTR_TSA_TABLE(first_table)</div>
<div class="line">FMSTR_TSA_TABLE_LIST_END()</div>
<div class="line"><span class="comment">/* End of FreeMASTER TSA table                                                */</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> main (<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">/* initialize SIM module and enable MCGIRCLK for use by peripherals         */</span></div>
<div class="line">  <a class="code" href="group__sim__macro.html#ga29bf1a8a2c379d066cbf00ce6f4b650b" title="SIM initialization. ">SIM_Init</a>  (<a class="code" href="group__sim__config.html#ga899efbad9c2c6af161201c24aafd9e71" title="Full configuration. ">SIM_MODULE_ALL_PERIPH_ON_CONFIG</a>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* enable MCGIRCLK for use by peripherals and change MCGIRCLK clock         */</span></div>
<div class="line">  <span class="comment">/* frequency from 2.097 MHz to 4.192 MHz                                    */</span></div>
<div class="line">  <a class="code" href="group__fll__macro.html#gae3fba014a9d37f5ec87f355b8441a656" title="Enables/disables internal reference clock for use as MCGIRCLK. ">FLL_CtrlIRCLKEN</a> (TRUE);</div>
<div class="line">  <a class="code" href="group__fll__macro.html#ga7cf9b99da93d8b7c7035f740bfb30a46" title="Selects fast clock internal reference divider. ">FLL_SetFastClkDiv</a>(<a class="code" href="group__firc__div__list.html#gaf4ca9c271287d63f55d53ea5fa66fc53" title="Divide factor is 1. ">FIRC_DIV1</a>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* initialize IRTC with 1 Hz fine pulse output (routed to PTF2)             */</span></div>
<div class="line">  <a class="code" href="group__irtc__macro.html#ga349e128f77136bd8a0386dd9153c634f" title="Initializes IRTC module with WKUP/TAMPER0 pin assigned to tamper mode. ">IRTC_Init</a> (<a class="code" href="group__irtc__config.html#gadb6c1266a5b12fc675e21d7ad884fe93" title="IRTC enhanced configuration with fine crystal compensation enabled. ">IRTC_MODULE_COMP_FINE_CONFIG</a>(<a class="code" href="group__irtc__lfsr__clk.html#gacf5be3d8ace211fc77d9baef6d19f570" title="Line Following Shift Register clock is 2Hz. ">LFSR_CLK_2HZ</a>,0,int_comp_val,fra_comp_val),</div>
<div class="line">             <a class="code" href="group__irtc__tamper__config.html#ga3143974fe41caef652ea157c1532a133" title="IRTC tamper pin functionality disabled. ">IRTC_TAMPER_PIN_DI_CONFIG</a>,</div>
<div class="line">             <a class="code" href="group__irtc__tamper__config.html#ga3143974fe41caef652ea157c1532a133" title="IRTC tamper pin functionality disabled. ">IRTC_TAMPER_PIN_DI_CONFIG</a>,</div>
<div class="line">             <a class="code" href="group__irtc__tamper__config.html#ga3143974fe41caef652ea157c1532a133" title="IRTC tamper pin functionality disabled. ">IRTC_TAMPER_PIN_DI_CONFIG</a>,</div>
<div class="line">             0);</div>
<div class="line">  <a class="code" href="group__irtc__macro.html#gae56378ca65fce130edc9f17ee05b64a4" title="Selects clock source to be outputted from device for use outside RTC. ">IRTC_SelRtcClkout</a> (<a class="code" href="group__irtc__clkout__src.html#ga63f315b6d697c98626a3602f58fb5302" title="Fine 1 Hz Clock. ">RTCCLKOUT_SRC1</a>);</div>
<div class="line">  <a class="code" href="group__gpio__macro.html#ga08ba8a1cfbaa12687a20d9e609609160" title="PORT pin(s) initialization. ">PORT_Init</a> (PORTF, <a class="code" href="group__port__config.html#ga305750cfc2b11cbc99a808bcd905a879" title="Configures pin(s) to Alternative 3 (chip-specific) mode. ">PORT_MODULE_ALT3_MODE</a>, <a class="code" href="group__pin__names.html#ga903210ad84aed4458cbc75b489f9bb7e" title="PIN 2. ">PIN2</a>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* initialize UART and FreeMASTER                                           */</span></div>
<div class="line">  <a class="code" href="group__gpio__macro.html#ga08ba8a1cfbaa12687a20d9e609609160" title="PORT pin(s) initialization. ">PORT_Init</a> (PORTI, <a class="code" href="group__port__config.html#ga04f71ff96eecc9ab06c8923d7fc715ef" title="Configures pin(s) to Alternative 2 (chip-specific) mode. ">PORT_MODULE_ALT2_MODE</a>, <a class="code" href="group__pin__names.html#ga8909e4cc8d1f05aeb73943042144abdf" title="PIN 0 (LSB) ">PIN0</a>|<a class="code" href="group__pin__names.html#ga522e24eb599eab6d1ec4b1ae5a3a12b2" title="PIN 1. ">PIN1</a>);</div>
<div class="line">  <a class="code" href="group__uart__macro.html#gad82f571acb055cd28bdf59b2b3dce58a" title="UART initialization. ">UART_Init</a> (UART1, <a class="code" href="group__uart__config.html#ga606ef32d34366cb956dbc034410889ed" title="Configures UART to operate in polling mode. Receive and transmit data is not inverted. ">UART_MODULE_POLLMODE_CONFIG</a>(38400,4e6));</div>
<div class="line"></div>
<div class="line">  FMSTR_Init();</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">while</span>(1)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="group__irtc__macro.html#gaf53913a5caa31023fe680a79fd15a004" title="Updates fine compensation value. ">IRTC_UpdateFineCompVal</a> (int_comp_val,fra_comp_val);</div>
<div class="line">    FMSTR_Poll             ();</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --> </dd></dl>
<dl class="section user"><dt>Freemaster_cfg.h:</dt><dd><div class="fragment"><div class="line"><span class="comment">/***************************************************************************/</span></div>
<div class="line"><span class="preprocessor">#ifndef __FREEMASTER_CFG_H</span></div>
<div class="line"><span class="preprocessor">#define __FREEMASTER_CFG_H</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/******************************************************************************</span></div>
<div class="line"><span class="comment">* Select interrupt or poll-driven serial communication</span></div>
<div class="line"><span class="comment">*******************************************************************************/</span></div>
<div class="line"><span class="preprocessor">#define FMSTR_LONG_INTR        0    </span><span class="comment">/* complete msg processing in interrupt   */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define FMSTR_SHORT_INTR       0    </span><span class="comment">/* SCI FIFO-queuing done in interrupt     */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define FMSTR_POLL_DRIVEN      1    </span><span class="comment">/* no interrupt needed, polling only      */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="comment">/******************************************************************************</span></div>
<div class="line"><span class="comment">* Select SCI communication interface</span></div>
<div class="line"><span class="comment">*******************************************************************************/</span></div>
<div class="line"><span class="preprocessor">#define FMSTR_USE_SCI          1    </span><span class="comment">/* To select SCI communication interface  */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define FMSTR_USE_PDBDM        0    </span><span class="comment">/* To select Packet Driven BDM interface  */</span><span class="preprocessor"></span></div>
<div class="line"><span class="comment">//#define FMSTR_SCI_BASE 0x4006A000   /* UART0 base on MKM34Z50                 */</span></div>
<div class="line"><span class="preprocessor">#define FMSTR_SCI_BASE 0x4006B000   </span><span class="comment">/* UART1 base on MKM34Z50                 */</span><span class="preprocessor"></span></div>
<div class="line"><span class="comment">//#define FMSTR_SCI_BASE 0x4006C000   /* UART2 base on MKM34Z50                 */</span></div>
<div class="line"><span class="comment">//#define FMSTR_SCI_BASE 0x4006D000   /* UART3 base on MKM34Z50                 */</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/******************************************************************************</span></div>
<div class="line"><span class="comment">* Input/output communication buffer size</span></div>
<div class="line"><span class="comment">*******************************************************************************/</span></div>
<div class="line"><span class="preprocessor">#define FMSTR_COMM_BUFFER_SIZE 200  </span><span class="comment">/* set to 0 for &quot;automatic&quot;               */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="comment">/******************************************************************************</span></div>
<div class="line"><span class="comment">* Receive FIFO queue size (use with FMSTR_SHORT_INTR only)</span></div>
<div class="line"><span class="comment">*******************************************************************************/</span></div>
<div class="line"><span class="preprocessor">#define FMSTR_COMM_RQUEUE_SIZE 32   </span><span class="comment">/* set to 0 for &quot;default&quot;                 */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="comment">/******************************************************************************</span></div>
<div class="line"><span class="comment">* Support for Application Commands</span></div>
<div class="line"><span class="comment">*******************************************************************************/</span></div>
<div class="line"><span class="preprocessor">#define FMSTR_USE_APPCMD       0    </span><span class="comment">/* enable/disable App.Commands support    */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define FMSTR_APPCMD_BUFF_SIZE 32   </span><span class="comment">/* App.Command data buffer size           */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define FMSTR_MAX_APPCMD_CALLS 4    </span><span class="comment">/* num. of app.cmd callbacks? (0=disable) */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="comment">/******************************************************************************</span></div>
<div class="line"><span class="comment">* Oscilloscope support</span></div>
<div class="line"><span class="comment">*******************************************************************************/</span></div>
<div class="line"><span class="preprocessor">#define FMSTR_USE_SCOPE        1    </span><span class="comment">/* enable/disable scope support           */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define FMSTR_MAX_SCOPE_VARS   8    </span><span class="comment">/* max. number of scope variables (2..8)  */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="comment">/******************************************************************************</span></div>
<div class="line"><span class="comment">* Recorder support</span></div>
<div class="line"><span class="comment">*******************************************************************************/</span></div>
<div class="line"><span class="preprocessor">#define FMSTR_USE_RECORDER     1    </span><span class="comment">/* enable/disable recorder support        */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define FMSTR_MAX_REC_VARS     8    </span><span class="comment">/* max. num. of recorder variables (2..8) */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* built-in recorder buffer (use when FMSTR_REC_OWNBUFF is 0)                 */</span></div>
<div class="line"><span class="preprocessor">#define FMSTR_REC_BUFF_SIZE    4096 </span><span class="comment">/* built-in buffer size                   */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* recorder time base, specifies how often the recorder is called             */</span></div>
<div class="line"><span class="preprocessor">#define FMSTR_REC_TIMEBASE     FMSTR_REC_BASE_MILLISEC(0) </span><span class="comment">/* 0 = &quot;unknown&quot;    */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define FMSTR_REC_FLOAT_TRIG   0    </span><span class="comment">/* enable/disable floating point trigger  */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="comment">/******************************************************************************</span></div>
<div class="line"><span class="comment">* Target-side address translation (TSA)</span></div>
<div class="line"><span class="comment">*******************************************************************************/</span></div>
<div class="line"><span class="preprocessor">#define FMSTR_USE_TSA          1    </span><span class="comment">/* enable TSA functionality               */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define FMSTR_USE_TSA_SAFETY   1    </span><span class="comment">/* enable access to TSA variables only    */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define FMSTR_USE_TSA_INROM    1    </span><span class="comment">/* TSA tables as const (put to ROM)       */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="comment">/******************************************************************************</span></div>
<div class="line"><span class="comment">* Enable the byte access to communication buffer. All Cortex M0-based devices</span></div>
<div class="line"><span class="comment">* require this option to be set in order to avoid misaligned access to integer</span></div>
<div class="line"><span class="comment">* parameters which is unsupported on this platform.</span></div>
<div class="line"><span class="comment">*******************************************************************************/</span></div>
<div class="line"><span class="preprocessor">#define FMSTR_BYTE_BUFFER_ACCESS 1</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* __FREEMASTER_CFG_H */</span><span class="preprocessor"></span></div>
</div><!-- fragment --> </dd></dl>
<dl class="section user"><dt>Toolchain support:</dt><dd><table class="doxtable">
<tr>
<th align="center"><code>IAR EWARM 7.40.7</code></th><th align="center"><code>CodeWarrior 10.6</code></th><th align="center"><code>KEIL uVision 5.15</code></th><th align="center"><code>CrossWorks 3.6</code></th><th align="center"><code>ATOLLIC TrueStudio 5.3.0</code></th><th align="center"><code>Kinetis Design Studio 3.0.0</code>  </th></tr>
<tr>
<td align="center"><b>&diams;</b> </td><td align="center"><b>&diams;</b> </td><td align="center"><b>&diams;</b> </td><td align="center"><b>&diams;</b> </td><td align="center"><b>&diams;</b> </td><td align="center"><b>&diams;</b> </td></tr>
</table>
</dd></dl>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.9-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul class="foot">
    <li class="footer">Tue Nov 22 2016 &copy; 2016 NXP Semiconductors, Inc. All rights reserved.
    </li>
  </ul>
</div>
</body>
</html>
