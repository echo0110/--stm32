<!-- HTML header for doxygen 1.8.9-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>MKMxxZxxACxx5 Bare Metal Software Drivers: SVC Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://www.mathjax.org/mathjax/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="drivers.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="nxp_logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">MKMxxZxxACxx5 Bare Metal Software Drivers
   &#160;<span id="projectnumber">R4.1.6</span>
   </div>
   <div id="projectbrief">Reference Manual</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Introduction</span></a></li>
      <li><a href="pages.html"><span>Pages</span></a></li>
      <li><a href="modules.html"><span>Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__svc__example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">SVC Example<div class="ingroups"><a class="el" href="group__kinetiskm__interface.html">MKMxxZxxACxx5 Platform Interface</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p>The ARM Cortex M0+ core provides optional privilege levels for software execution:</p><ul>
<li>In handler or thread privileged modes the software can use all the instructions and has access to all resources.</li>
<li>In thread user (unprivileged) mode the software has limited access to system registers, cannot access the system timer, the NVIC, or the system control block. Other restrictions to access to memories or peripherals may be imposed.</li>
</ul>
<p>An unprivileged software can use the <a class="el" href="group__cm0plus__macros.html#ga61ac7fc362bd53929b26388076ac9be9">SVC_Call</a> macro to initiate a supervisor call to transfer control to a privileged software. In addition to execution levels the ARM Cortex M0+ implements two stacks, the main stack and the process stack, with independent copies of the stack pointer. This example shows typical use of the supervisor call to switch ARM Cortex M0+ execution from thread user (unprivileged) mode to the handler (privileged) mode. The device enters the thread (privileged) execution mode after POR with main stack selected. After supervisor callback function is initialized, using <a class="el" href="group__cm0plus__macros.html#ga08bd7781858ad898706f60fee9e2e7f7">SVC_InstallCallback</a> function, the software switches execution mode to the thread user (unprivileged) and to use process stack. Then the <code>user_function()</code> is called from within a loop. The <code>user_function()</code> toggles two LEDs by initiating a supervisor call. The LEDs are toggled by the <code>svc_callback()</code> function executed in the handler (privileged) mode. After callback function terminates the ARM Cortex M0+ enters thread user (unprivileged) mode and the execution of the <code>user_function()</code> resumes.</p>
<dl class="section user"><dt>Source code:</dt><dd><div class="fragment"><div class="line"><span class="comment">/******************************************************************************</span></div>
<div class="line"><span class="comment"> * (c) Copyright 2016, Freescale Semiconductor Inc.</span></div>
<div class="line"><span class="comment"> * ALL RIGHTS RESERVED.</span></div>
<div class="line"><span class="comment"> ******************************************************************************</span></div>
<div class="line"><span class="comment"> * svc_test.c</span></div>
<div class="line"><span class="comment"> ******************************************************************************/</span></div>
<div class="line"><span class="preprocessor">#include &quot;drivers.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* LEDs definition                                                            */</span></div>
<div class="line"><span class="preprocessor">#define LED1    PIN5        </span><span class="comment">/* PTE5 */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define LED2    PIN1        </span><span class="comment">/* PTF1 */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* define supervisor service commands                                         */</span></div>
<div class="line"><span class="preprocessor">#define SVC_TGL_LED1()  SVC_Call(0x01)</span></div>
<div class="line"><span class="preprocessor">#define SVC_TGL_LED2()  SVC_Call(0x02)</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* supervisor service callback function definition; this function executes in */</span></div>
<div class="line"><span class="comment">/* handler (privileged) mode and it uses main stack. Note that modification   */</span></div>
<div class="line"><span class="comment">/* of any special registers within this mode is allowed                       */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> svc_callback (<a class="code" href="group__basic__data__types.html#gadde6aaee8457bee49c2a92621fe22b79" title="8-bit unsigned integer ">uint8</a> imm)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span> (imm == 0x01) { <a class="code" href="group__gpio__macro.html#ga033e050b51ceb6ccc9f5a5aae6c668cc" title="Toggles pin(s) of the port. ">GPIO_Tgl</a> (FGPIOE, LED1); }</div>
<div class="line">  <span class="keywordflow">if</span> (imm == 0x02) { <a class="code" href="group__gpio__macro.html#ga033e050b51ceb6ccc9f5a5aae6c668cc" title="Toggles pin(s) of the port. ">GPIO_Tgl</a> (FGPIOF, LED2); }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* user function definition; this function executes in the thread/user mode   */</span></div>
<div class="line"><span class="comment">/* where all attempts to modify any special register are ignored              */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> user_function (<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="group__cm0plus__macros.html#ga0b5ca6aa7c63e6a510cec72bb3f3f665" title="Delays software execution by number of core clock cycles. ">arch_delay</a>(100000);</div>
<div class="line">  SVC_TGL_LED1();         <span class="comment">/* LED1 toggle                                      */</span></div>
<div class="line">  <a class="code" href="group__cm0plus__macros.html#ga0b5ca6aa7c63e6a510cec72bb3f3f665" title="Delays software execution by number of core clock cycles. ">arch_delay</a>(100000);</div>
<div class="line">  SVC_TGL_LED2();         <span class="comment">/* LED2 toggle                                      */</span></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* device enters thread/privileged execution mode after POR; main stack is    */</span></div>
<div class="line"><span class="comment">/* selected                                                                   */</span></div>
<div class="line"><span class="keywordtype">void</span> main (<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">/* enable clocks to all on chip peripherals                                 */</span></div>
<div class="line">  <a class="code" href="group__sim__macro.html#ga29bf1a8a2c379d066cbf00ce6f4b650b" title="SIM initialization. ">SIM_Init</a> (<a class="code" href="group__sim__config.html#ga899efbad9c2c6af161201c24aafd9e71" title="Full configuration. ">SIM_MODULE_ALL_PERIPH_ON_CONFIG</a>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* initialize LEDs                                                          */</span></div>
<div class="line">  <a class="code" href="group__gpio__macro.html#ga08ba8a1cfbaa12687a20d9e609609160" title="PORT pin(s) initialization. ">PORT_Init</a> (PORTE , <a class="code" href="group__port__config.html#gaa55647ae2935b18d66a5697eaddf59b6" title="Configures pin(s) to Alternative 1 (GPIO) mode ready for controlling slow outputs such LEDs...">PORT_MODULE_LED_MODE</a>, LED1);</div>
<div class="line">  <a class="code" href="group__gpio__macro.html#ga08ba8a1cfbaa12687a20d9e609609160" title="PORT pin(s) initialization. ">PORT_Init</a> (PORTF , <a class="code" href="group__port__config.html#gaa55647ae2935b18d66a5697eaddf59b6" title="Configures pin(s) to Alternative 1 (GPIO) mode ready for controlling slow outputs such LEDs...">PORT_MODULE_LED_MODE</a>, LED2);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="group__gpio__macro.html#gae641bfa7cb9b73e36067e53200343900" title="GPIO pin(s) initialization. ">GPIO_Init</a> (FGPIOE, <a class="code" href="group__gpio__config.html#ga4b1dc7015e6651e129ce2fc9e6e44269" title="Configures pin(s) in output mode (logic level 1 is driven on pin). ">GPIO_OUT_LOGIC1_MODE</a>, LED1);</div>
<div class="line">  <a class="code" href="group__gpio__macro.html#gae641bfa7cb9b73e36067e53200343900" title="GPIO pin(s) initialization. ">GPIO_Init</a> (FGPIOF, <a class="code" href="group__gpio__config.html#ga4b1dc7015e6651e129ce2fc9e6e44269" title="Configures pin(s) in output mode (logic level 1 is driven on pin). ">GPIO_OUT_LOGIC1_MODE</a>, LED2);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* initialize supervisor callback function                                  */</span></div>
<div class="line">  <a class="code" href="group__cm0plus__macros.html#ga08bd7781858ad898706f60fee9e2e7f7" title="Installs callback function for Supervisor Call (SVC) interrupt vector 11. ">SVC_InstallCallback</a> (<a class="code" href="group__cm0plus__prilvl.html#gab04f6dcc0fae0bd8c5af1bb66eb9c035" title="Priority level 1. ">PRI_LVL1</a>, svc_callback);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* switch to process stack and enter thread/user execution mode; note that  */</span></div>
<div class="line">  <span class="comment">/* process stack as well as other memory sections shall be defined in linker*/</span></div>
<div class="line">  <span class="comment">/* file and protected by MPU on the contrary to this simple implementation  */</span></div>
<div class="line">  <a class="code" href="group__cm0plus__macros.html#ga899c65ca7d13a88b967a18bca4317a06" title="Sets top of Process Stack Pointer (PSP). ">SetPSP</a>  (0x20000000);   <span class="comment">/* setup process stack pointer                      */</span></div>
<div class="line">  <a class="code" href="group__cm0plus__macros.html#gac004da86b664c89d2c13ad88718e8461" title="Switches stack pointer to Process Stack Pointer (PSP). ">SelPSP</a>  ();             <span class="comment">/* select process stack                             */</span></div>
<div class="line">  <a class="code" href="group__cm0plus__macros.html#ga5da0b4bd4b7a8ef8a479008c8ed455c8" title="Enables all interrupts. ">EnableInterrupts</a>();     <span class="comment">/* enable interrupts                                */</span></div>
<div class="line">  <a class="code" href="group__cm0plus__macros.html#ga69392cd7e52c9281da1fc14e923df040" title="Enters unprivileged (user) mode of execution. ">UserMode</a>();             <span class="comment">/* switch into thread/user mode                     */</span></div>
<div class="line"></div>
<div class="line">  <span class="comment">/* main software loop executes in thread user mode with using process stack */</span></div>
<div class="line">  <span class="keywordflow">while</span> (1) { user_function(); }</div>
<div class="line">}</div>
</div><!-- fragment --> </dd></dl>
<dl class="section user"><dt>Toolchain support:</dt><dd><table class="doxtable">
<tr>
<th align="center"><code>IAR EWARM 7.40.7</code></th><th align="center"><code>KEIL uVision 5.15</code></th><th align="center"><code>CrossWorks 3.6</code></th><th align="center"><code>ATOLLIC TrueStudio 5.3.0</code></th><th align="center"><code>Kinetis Design Studio 3.0.0</code>  </th></tr>
<tr>
<td align="center"><b>&diams;</b> </td><td align="center"><b>&diams;</b> </td><td align="center"><b>&diams;</b> </td><td align="center"><b>&diams;</b> </td><td align="center"><b>&diams;</b> </td></tr>
</table>
</dd></dl>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.9-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul class="foot">
    <li class="footer">Tue Nov 22 2016 &copy; 2016 NXP Semiconductors, Inc. All rights reserved.
    </li>
  </ul>
</div>
</body>
</html>
